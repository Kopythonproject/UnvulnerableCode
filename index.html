<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>명령어 도우미</title>
  <style>
    body {
      margin: 0;
      background: #1e1e1e;
      color: #d4d4d4;
      font-family: 'Courier New', monospace;
      padding: 20px;
    }
    #output {
      white-space: pre-line;
      margin-bottom: 10px;
    }
    #input {
      width: 100%;
      background: #1e1e1e;
      border: none;
      border-top: 1px solid #444;
      color: #d4d4d4;
      padding: 10px;
      font-size: 16px;
    }
    #output .log-block {
      white-space: pre-line;
      margin-bottom: 10px;
    }
    .alert-box {
      position: fixed;
      top: 20px;
      right: 20px;
      background: #ffeb3b;
      color: #000;
      padding: 10px 20px;
      border-radius: 8px;
      font-weight: bold;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
      z-index: 9999;
      animation: fadein 0.5s ease;
    }
    .title-box {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 36px;
      color: skyblue;
      background-color: rgba(0, 0, 0, 0.7);
      padding: 20px;
      border-radius: 12px;
      z-index: 9999;
      font-weight: bold;
    }
    #recordBtn {
      display: none;
      position: fixed;
      bottom: 20px;
      right: 20px;
      padding: 10px 20px;
      background: #2196f3;
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 14px;
      cursor: pointer;
      z-index: 10000;
    }
        #thankyou-msg {
      font-size: 20px;
      color: #ffcc00;
      text-align: center;
      margin-top: 20px;
    }
    @keyframes fadein {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>
<body>
<h1>Unvulnerable 코딩언어 (Made by 범서) Ver 0.1 A</h1>
  <div id="output">명령어를 입력하세요. (help 입력)</div>
  <input id="input" autofocus autocomplete="off" placeholder="> 명령어 입력">
  <button id="recordBtn">녹화 시작</button>
  <script>
    const input = document.getElementById('input');
    const output = document.getElementById('output');
    const recordBtn = document.getElementById('recordBtn');

    let mediaRecorder = null;
    let recordedChunks = [];
    let streamRef = null;

    input.addEventListener('keydown', e => {
      if (e.key === 'Enter') {
        const command = input.value.trim();
        handleCommand(command);
        input.value = '';
      }
    });

    function handleCommand(cmd) {
      const stringPattern = /^title\s+string\s*\{\s*"(.*?)"\s*\}(.*)$/i;
      const numPattern = /^title\s+num\s*\{\s*(\d+)\s*\}(.*)$/i;
      const alertStrPattern = /^alert\s+string\s*\{\s*\"(.*?)\"\s*\}$/i;
      const alertNumPattern = /^alert\s+num\s*\{\s*(\d+)\s*\}$/i;
      const thankyouPattern = /^thankyou\s*\{\s*timeout\s*:\s*(\d+)\s*\}(.*)$/i;
    


       const helpText = `사용 가능한 명령어:\n- help\n- title string {"문자열"} [옵션들]\n- title num {숫자} [옵션들]\n- title clear all\n- title clear recent\n- cls all\n- cls recent\n- alert string {"문자열"}\n- alert num {숫자}\n- record myself\n- record otherpage\n- record showbutton\n- record save\n- record clear\n- thankyou {timeout:n} [nothankyou:"True"]`;

      let match, text = '', timeout = 3, color = 'skyblue', isBold = false, isItalic = false;
      const lowerCmd = cmd.toLowerCase();

      const block = document.createElement('div');
      block.className = 'log-block';
      block.innerText = `> ${cmd}`;
      output.appendChild(block);

      if ((match = cmd.match(thankyouPattern))) {
  const timeoutVal = parseInt(match[1]);
  const options = match[2] || '';
  const noThankYou = /\[nothankyou\s*:\s*"true"\s*\]/i.test(options);
  const inputBox = document.getElementById('input');
  inputBox.style.display = 'none';

  if (!noThankYou) {
    const msg = document.createElement('div');
    msg.id = 'thankyou-msg';
    msg.innerText = 'Thank You!';
    output.appendChild(msg);
  }

  setTimeout(() => {
    inputBox.style.display = 'block';
    const msg = document.getElementById('thankyou-msg');
    if (msg) msg.remove();
  }, timeoutVal * 1000);

  block.innerText += `\n감사 메시지를 표시하고 입력란을 잠시 숨깁니다.`;
  return;
}


      if (lowerCmd === 'help') {
        block.innerText += `\n${helpText}`;
        return;
        
      } else if (lowerCmd === 'title clear all') {
        document.querySelectorAll('.title-box').forEach(el => el.remove());
        block.innerText += `\n모든 타이틀을 제거했습니다.`;
        return;
      } else if (lowerCmd === 'title clear recent') {
        const boxes = document.querySelectorAll('.title-box');
        if (boxes.length > 0) {
          boxes[boxes.length - 1].remove();
          block.innerText += `\n가장 최근 타이틀 하나를 제거했습니다.`;
        } else {
          block.innerText += `\n⚠ 오류: 제거할 타이틀이 없습니다.`;
        }
        return;
      } else if (lowerCmd === 'cls all') {
        document.querySelectorAll('.log-block').forEach(el => el.remove());
        return;
      } else if (lowerCmd === 'cls recent') {
        const blocks = document.querySelectorAll('.log-block');
        if (blocks.length > 0) {
          blocks[blocks.length - 1].remove();
        } else {
          block.innerText += `\n⚠ 오류: 삭제할 로그가 없습니다.`;
        }
        return;
        
      } else if (lowerCmd === 'record myself') {
        navigator.mediaDevices.getUserMedia({ video: true, audio: true })
          .then(stream => {
            streamRef = stream;
            mediaRecorder = new MediaRecorder(stream);
            mediaRecorder.ondataavailable = e => recordedChunks.push(e.data);
            block.innerText += `\n카메라 녹화 준비 완료.`;
          })
          .catch(() => block.innerText += `\n⚠ 오류: 카메라 접근이 거부되었습니다.`);
        return;
      } else if (lowerCmd === 'record otherpage') {
        block.innerText += `\n녹화할 화면을 선택해주세요.`;
        navigator.mediaDevices.getDisplayMedia({ video: true, audio: true })
          .then(stream => {
            streamRef = stream;
            mediaRecorder = new MediaRecorder(stream);
            mediaRecorder.ondataavailable = e => recordedChunks.push(e.data);
            block.innerText += `\n화면 녹화 준비 완료.`;
          })
          .catch(() => block.innerText += `\n⚠ 오류: 화면 공유가 취소되었습니다.`);
        return;
      } else if (lowerCmd.startsWith('record showbutton')) {
  const sizeMatch = cmd.match(/\[buttonsize\s*:\s*"(large|medium|small)"\s*\]/i);
  let size = 'medium';
  if (sizeMatch) size = sizeMatch[1].toLowerCase();

  // 버튼 크기 설정
  let fontSize = '14px', padding = '10px 20px';
  if (size === 'large') {
    fontSize = '20px'; padding = '14px 28px';
  } else if (size === 'small') {
    fontSize = '10px'; padding = '6px 12px';
  }

  recordBtn.style.fontSize = fontSize;
  recordBtn.style.padding = padding;
  recordBtn.style.display = 'block';
  block.innerText += `\n녹화 버튼이 '${size}' 크기로 활성화되었습니다.`;
  return;

} else if (lowerCmd.startsWith('record save')) {
  if (recordedChunks.length === 0) {
    block.innerText += `\n⚠ 오류: 저장할 녹화 데이터가 없습니다.`;
    return;
  }

  const fileMatch = cmd.match(/\[file\s*:\s*(mp4|webm|mp3)\s*\]/i);
  const fileType = fileMatch ? fileMatch[1].toLowerCase() : 'webm';

  let mimeType = 'video/webm';
  if (fileType === 'mp4') mimeType = 'video/mp4';
  else if (fileType === 'mp3') mimeType = 'audio/mp3';

  const blob = new Blob(recordedChunks, { type: mimeType });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = `recording.${fileType}`;
  a.click();
  URL.revokeObjectURL(url);

  block.innerText += `\n녹화 파일이 .${fileType} 형식으로 저장되었습니다.`;
  return;
}

       else if (lowerCmd === 'record clear') {
        recordedChunks = [];
        streamRef?.getTracks().forEach(track => track.stop());
        streamRef = null;
        mediaRecorder = null;
        recordBtn.style.display = 'none';
        block.innerText += `\n녹화 관련 리소스 초기화 완료.`;
        return;
      }

      if ((match = cmd.match(stringPattern))) {
        text = match[1];
        parseOptions(match[2]);
      } else if ((match = cmd.match(numPattern))) {
        text = match[1];
        parseOptions(match[2]);
      } else if ((match = cmd.match(alertStrPattern))) {
        showAlertBox(match[1]);
        block.innerText += `\n알림 표시: \"${match[1]}\"`;
        return;
      } else if ((match = cmd.match(alertNumPattern))) {
        showAlertBox(match[1]);
        block.innerText += `\n숫자 알림 표시: ${match[1]}`;
        return;
      } else if (/^title\s+(string|num)/i.test(cmd)) {
        block.innerText += `\n⚠ 오류: 명령어 형식이 잘못되었습니다.\n정확한 예: title string {"Hello"} 또는 title num {5}`;
        return;
      } else {
        block.innerText += `\n⚠ 오류: 알 수 없는 명령어입니다. (help 입력)`;
        return;
      }


      block.innerText += `\n타이틀 표시: ${text}`;
      showStyledTitle(text, timeout, color, isBold, isItalic);

      function parseOptions(optionStr) {
        try {
          const timeoutMatch = optionStr.match(/\[timeout\s*:\s*(\d+)\s*\]/i);
          const colorMatch = optionStr.match(/\[color\s*:\s*\"(.+?)\"\s*\]/i);
          const boldMatch = optionStr.match(/\[bold\s*:\s*\"true\"\s*\]/i);
          const italicMatch = optionStr.match(/\[italic\s*:\s*\"true\"\s*\]/i);

          if (timeoutMatch) timeout = parseInt(timeoutMatch[1]);
          if (colorMatch) color = colorMatch[1];
          if (boldMatch) isBold = true;
          if (italicMatch) isItalic = true;
        } catch (e) {
          block.innerText += `\n⚠ 옵션 구문 분석 중 오류 발생. 일부 옵션 무시됨.`;
        }
      }
    }

    function showStyledTitle(text, timeout, color, bold, italic) {
      const div = document.createElement('div');
      div.className = 'title-box';
      div.innerText = text;
      div.style.fontWeight = bold ? 'bold' : 'normal';
      div.style.fontStyle = italic ? 'italic' : 'normal';
      div.style.color = color;
      document.body.appendChild(div);
      setTimeout(() => div.remove(), timeout * 1000);
    }

    function showAlertBox(message) {
      const alert = document.createElement('div');
      alert.className = 'alert-box';
      alert.innerText = message;
      document.body.appendChild(alert);
      setTimeout(() => alert.remove(), 3000);
    }

    recordBtn.addEventListener('click', () => {
      if (!mediaRecorder) return alert('⚠ 녹화가 설정되지 않았습니다. 먼저 record myself나 otherpage 명령을 실행하세요.');
      if (mediaRecorder.state === 'recording') {
        mediaRecorder.stop();
        recordBtn.textContent = '녹화 시작';
      } else {
        recordedChunks = [];
        mediaRecorder.start();
        recordBtn.textContent = '녹화 중지';
      }
    });
  </script>
</body>
</html>